<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><chapter lang="ru" id="chapter3_examples">
  <title>Примеры построения отчетов</title>
  <para>Рассмотрим создание следующих отчетов.</para>
  <orderedlist>
    <listitem>
      <para><link linkend="report1_id">Отчет <guilabel>Накладная на продажу</guilabel></link></para>
    </listitem>
    <listitem>
      <para><link linkend="report2_id">Отчет <guilabel>Список продаж за период</guilabel></link></para>
    </listitem>
    <listitem>
      <para><link linkend="report3_id">Отчет <guilabel>Информация о товаре</guilabel></link></para>
    </listitem>
    <listitem>
      <para><link linkend="report4_id">Отчет <guilabel>По согласуемым документам</guilabel> (на примере системы <trademark>ТЕЗИС</trademark>)</link></para>
    </listitem>
  </orderedlist>
  <section id="report1_id">
    <title>Простой отчет с шаблоном *.odt</title>
    <para>Данный отчет представляет собой информацию о факте продажи товара − накладную на продажу.</para>
    <para>Начнем формирование отчета с создания шаблона. Для этого откройте <application>OpenOffice.org Writer</application>. Создайте в файле следующий шаблон отчета, представленный на рисунке.</para>
    <para>Обратите внимание на название таблицы.</para>
    <para>Сохраните шаблон отчета, назвав его <filename>saleInvoice.odt</filename>.</para>
    <figure>
      <title>Шаблон отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_1.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Далее зайдите в подсистему создания отчетов и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <para>В поле <guilabel>Имя</guilabel> введите имя отчета − <userinput>Sale invoice</userinput>, в качестве типа вывода отчета выберите значение <userinput>Простой отчет</userinput>. </para>
    <figure>
      <title>Окно создания отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_2.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Далее на панели <guilabel>Шаблоны</guilabel> нажмите на кнопку <guibutton>Создать</guibutton>. После этого откроется диалоговое окно, представленное на рисунке.</para>
    <figure>
      <title>Окно редактора шаблона</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_3.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В качестве кода шаблона оставьте значение по умолчанию, в поле <guilabel>Тип вывода</guilabel> выберите значение <userinput>Doc</userinput>. Далее нажмите на кнопку <guibutton>Загрузить</guibutton> и в открывшемся окне укажите путь к созданному ранее шаблону <filename>saleInvoice.odt</filename>.</para>
    <para>Далее создадим входной параметр отчета. Очевидно, входным параметром будет являться одна запись продажи, выбранная  из списка продаж. Для создания параметра нажмите на кнопку <guibutton>Создать</guibutton> на панели <guilabel>Параметры</guilabel>. </para>
    <figure>
      <title>Окно редактора параметров</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_4.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля параметра. В поле <guilabel>Имя параметра</guilabel> введите <userinput>Sale</userinput>, в качестве <glossterm linkend="glossary_alias_id">алиаса</glossterm> параметра укажите <userinput>sale</userinput>. Выберите тип параметра <userinput>Объект</userinput> из списка типов. Далее установите флажок <guilabel>Обязательный параметр?</guilabel>. В качестве сущности выберите <userinput>Sale</userinput> из списка сущностей. В списке экранов выбора сущности найдите экран <userinput>shop$Sale.browse</userinput>. Далее перейдите на вкладку <guilabel>Локализация</guilabel>.</para>
    <figure>
      <title>Локализация названия параметра</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_5.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В поле <guilabel>Строки локализации</guilabel> введите значение <userinput>ru=Продажа</userinput> и нажмите на кнопку <guibutton>ОК.</guibutton></para>
    <para>Далее приступим к созданию полос отчета. Для создания новой полосы выделите корневую полосу отчета <guilabel>Root</guilabel> и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <figure>
      <title>Окно создания полос отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_6.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля источника данных значениями, приведенными на рисунке.</para>
    <figure>
      <title>Создание полосы Sale</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_7.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Текст запроса <glossterm linkend="glossary_jpql_id">JPQL</glossterm>:</para>
    <programlisting>select 
sb.personalData.fullName as buyer, 
ss.orderDate as orderDate,
sp.personalData.fullName as salesPerson, 
ss.deliveryDate as deliveryDate,
ss.deliveryAddress as deliveryAddress,
ss.priceDescription as priceDescription 
from shop$Sale ss, shop$Buyer sb, shop$SalesPerson sp
where 
ss.id = ${sale}
and sb.id = ss.buyer.id
and sp.id = ss.salesPerson.id</programlisting>
    <warning>
      <para>Обратите внимание, что <glossterm linkend="glossary_alias_id">алиасы</glossterm> в запросе называются так же, как в создаваемом шаблоне, а в качестве идентификатора сущности <code>shop$Sale</code> передается входной параметр <code>sale</code>, заключенный в конструкцию <code>${}</code> − <code>${sale}</code>.</para>
    </warning>
    <para>После создания полосы отчета <guilabel>Sale</guilabel> создадим полосу отчета <guilabel>Product</guilabel>. Для этого выделите корневую полосу отчета <guilabel>Root</guilabel> и нажмите на кнопку <guibutton>Создать</guibutton>. Далее заполните поля источника данных в соответствии с рисунком.</para>
    <figure>
      <title>Создание полосы Product</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_8.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Текст скрипта:</para>
    <programlisting>select 
sp.name as tName, 
ss.quantity as tQuantity, 
ss.price as tPrice 
from shop$Sale ss, shop$Product sp
where 
ss.id = ${sale}
and  sp.id = ss.product.id</programlisting>
    <para>После создания полос перейдите на вкладку <guilabel>Локализация</guilabel> редактора отчетов и введите в поле <guilabel>Строки локализации </guilabel>следующее:</para>
    <para><userinput>ru=Накладная на продажу</userinput></para>
    <para>После этого нажмите на кнопку <guibutton>ОК</guibutton>. Новый отчет создан и сохранен в базе данных.</para>
    <para>Запустим отчет на выполнение. Для этого вернитесь на вкладку <guilabel>Список отчетов</guilabel> (<guimenu>Отчеты</guimenu> −&gt; <guimenu>Отчеты</guimenu>). </para>
    <figure>
      <title>Запуск отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_9.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выделите отчет <guilabel>Накладная на продажу</guilabel> в списке отчетов и нажмите на кнопку <guibutton>Выполнить.</guibutton> После этого откроется окно ввода параметров отчета. Данное окно представлено на рисунке.</para>
    <figure>
      <title>Окно ввода параметров отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_10.png" contentwidth="83%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В поле <guilabel>Продажа</guilabel> нажмите на кнопку <inlinemediaobject>
        <imageobject>
          <imagedata fileref="img/dots.png"/>
        </imageobject>
      </inlinemediaobject>. После этого откроется окно выбора существующих продаж, произведенных с помощью системы. </para>
    <figure>
      <title>Окно выбора продаж</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_11.png" contentwidth="84%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выделите в таблицу запись, по которой нужно получить отчет, и нажмите на кнопку <guibutton>Выбрать</guibutton>.</para>
    <para>После этого нажмите на кнопку <guibutton>Печатать отчет</guibutton> в окне ввода параметров отчета.</para>
    <figure>
      <title/>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_12.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выгруженный отчет представлен на рисунке ниже.</para>
    <figure>
      <title>Выгруженный отчет</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_13.png"/>
        </imageobject>
      </mediaobject>
    </figure>
  </section>
  <section id="report2_id">
    <title>Простой отчет с шаблоном *.xls</title>
    <para>Данный отчет представляет собой информацию о  продажах, произведенных за определенный период, который задается параметрами отчета.</para>
    <para>Начнем формирование отчета с создания шаблона. Для этого откройте <application>OpenOffice.org Calc</application>. Создайте в файле следующий шаблон отчета, представленный на рисунке.</para>
    <figure>
      <title>Создание шаблона отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_1.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Задайте именованные регионы согласно изображениям, представленным ниже.</para>
    <figure>
      <title>Именованный регион Header</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_10.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион UnderHeader</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_11.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион Date</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_2.png" contentwidth="70%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион UnderDate</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_12.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион HeaderOfTable</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_3.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион Sales</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_4.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Сохраните шаблон отчета, назвав его <filename>saleForPeriod.xls</filename>.</para>
    <para>Далее зайдите в подсистему создания отчетов и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <para>В поле <guilabel>Имя</guilabel> введите имя отчета − <userinput>Sales for period</userinput>, в качестве типа вывода отчета выберите значение <userinput>Простой отчет</userinput>. </para>
    <figure>
      <title>Окно создания отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_5.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Далее на панели <guilabel>Шаблоны</guilabel> нажмите на кнопку <guibutton>Создать</guibutton>. После этого откроется диалоговое окно, представленное на рисунке.</para>
    <figure>
      <title>Окно редактора шаблона</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_6.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В качестве кода шаблона оставьте значение по умолчанию, в поле <guilabel>Тип вывода</guilabel> выберите значение <userinput>Xls</userinput>. Далее нажмите на кнопку <guibutton>Загрузить</guibutton> и в открывшемся окне укажите путь к созданному ранее шаблону <filename>saleForPeriod.xls</filename>.</para>
    <para>Далее создадим входные параметры отчета. Очевидно, входными параметрами будут являться дата начала периода и дата окончания периода. Для создания параметра нажмите на кнопку <guibutton>Создать</guibutton> на панели <guilabel>Параметры</guilabel>. </para>
    <figure>
      <title>Окно редатора параметра Period Start</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_7.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля параметра. В поле <guilabel>Имя параметра</guilabel> введите <userinput>Period start</userinput>, в качестве <glossterm linkend="glossary_alias_id">алиаса</glossterm> параметра укажите <userinput>start</userinput>. Выберите тип параметра <userinput>Дата</userinput> из списка типов. Далее установите флажок <guilabel>Обязательный параметр?</guilabel>.  Далее перейдите на вкладку <guilabel>Локализация</guilabel>.</para>
    <figure>
      <title>Вкладка локализации параметра</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_8.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В поле <guilabel>Строки локализации</guilabel> введите значение <userinput>ru=Дата начала периода</userinput> и нажмите на кнопку <guibutton>ОК</guibutton>.</para>
    <para>По аналогии создайте второй параметр − <guilabel>Дата окончания периода</guilabel>.</para>
    <figure>
      <title>Окно редактора параметра Period end</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_9].png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Далее приступим к созданию полос отчета. Для создания новой полосы выделите корневую полосу отчета <guilabel>Root</guilabel> и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <figure>
      <title>Окно создания полос отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_6.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля источника данных значениями, приведенными на рисунке.</para>
    <figure>
      <title>Создание полосы Sales</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_13.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Текст запроса SQL:</para>
    <programlisting>select SB.NAME as buyer,
SP.NAME as product,
SS.NAME as salesPerson,
S.ORDER_DATE as orderDate,
S.DELIVERY_DATE as deliveryDate,
S.QUANTITY as quantity,
S.PRICE as price,
S.PRICE_DESCRIPTION as priceDescription,
S.DELIVERY_ADDRESS as deliveryAddress
from SHOP_SALE S
left join (select SB.ID as ID, SB.FULL_NAME as NAME from SHOP_BUYER SB) 
as SB on SB.ID = S.BUYER_ID
left join (select SP.ID as ID, SP.FULL_NAME as NAME from SHOP_SALES_PERSON SP) 
as SS on SS.ID = S.SALES_PERSON_ID
left join (select SP.ID as ID, SP.NAME as NAME from SHOP_PRODUCT SP) 
as SP on SP.ID= S.PRODUCT_ID
where S.ORDER_DATE&gt;=${start}
and S.ORDER_DATE&lt;=${end}
and S.DELETE_TS is null</programlisting>
    <warning>
      <para>Обратите внимание, что <glossterm linkend="glossary_alias_id">алиасы</glossterm> в запросе называются также, как в созданном шаблоне, а для фильтрации значений передаются входные параметры отчета <code>${start}</code> и <code>${end}</code>.</para>
    </warning>
    <para>После создания полосы отчета <guilabel>Sales</guilabel> создайте пустые полосы отчета и расположите их в порядке, определенном на рисунке. </para>
    <figure>
      <title>Полосы отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_14.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Полосы отчета пустые, так как в соответствующие им именованные регионы шаблона не требуется выводить данные из базы данных.</para>
    <para>После создания полос перейдите на вкладку <guilabel>Локализация</guilabel> редактора отчетов и введите в поле <guilabel>Строки локализации </guilabel>следующее:</para>
    <para><userinput>ru=Список продаж за период</userinput></para>
    <para>После этого нажмите на кнопку <guibutton>ОК</guibutton>. Новый отчет создан и сохранен в базе данных.</para>
    <para>Запустим отчет на выполнение. Для этого вернитесь на вкладку <guilabel>Список отчетов</guilabel> (<guimenu>Отчеты</guimenu> −&gt; <guimenu>Отчеты</guimenu>). </para>
    <figure>
      <title>Выполнение отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_15.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выделите     отчет   <guilabel>Список продаж за период</guilabel>  в  списке                     и  нажмите на кнопку    <guibutton>Выполнить.</guibutton> После этого откроется окно ввода параметров отчета. Данное окно представлено на рисунке.</para>
    <figure>
      <title>Окно ввода параметров отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_16.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выберите даты начала периода и окончания периода с помощью кнопки <inlinemediaobject>
        <imageobject>
          <imagedata fileref="img/calendar.png"/>
        </imageobject>
      </inlinemediaobject>. </para>
    <para>После этого нажмите на кнопку <guibutton>Печатать отчет</guibutton> в окне ввода параметров отчета.</para>
    <figure>
      <title>Печать отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_17.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выгруженный отчет представлен на рисунке ниже.</para>
    <figure>
      <title>Выгруженный отчет</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example2_18.png"/>
        </imageobject>
      </mediaobject>
    </figure>
  </section>
  <section id="report3_id">
    <title>Печатная форма отчета с шаблоном *.odt</title>
    <para>Данный отчет представляет собой информацию о товаре.</para>
    <para>Начнем  формирование отчета с создания шаблона. Для этого откройте <application>OpenOffice.org Writer</application>. Создайте в файле следующий шаблон отчета, представленный на рисунке.</para>
    <figure>
      <title>Создание шаблона отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_1.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Обратите внимание на название таблицы.</para>
    <para>Сохраните шаблон отчета, назвав его <filename>Product.odt</filename>.</para>
    <para>Далее зайдите в подсистему создания отчетов и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <para>В поле <guilabel>Имя</guilabel> введите имя отчета − <userinput>Product info</userinput>, в качестве типа вывода отчета выберите значение <userinput>Печатная форма</userinput>. </para>
    <figure>
      <title>Окно создания отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_2.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Далее на панели <guilabel>Шаблоны</guilabel> нажмите на кнопку <guibutton>Создать</guibutton>. После этого откроется диалоговое окно, представленное на рисунке.</para>
    <figure>
      <title>Окно редактора шаблона</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_3.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В качестве кода шаблона оставьте значение по умолчанию, в поле <guilabel>Тип вывода</guilabel> выберите значение <userinput>Doc</userinput>. Далее нажмите на кнопку <guibutton>Загрузить</guibutton> и в открывшемся окне укажите путь к созданному ранее шаблону <filename>Product.odt</filename>.</para>
    <para>Далее создадим входной параметр отчета. Очевидно, входным параметром будет являться одна запись товара, выбранная  из списка товаров. Для создания параметра нажмите на кнопку <guibutton>Создать</guibutton> на панели <guilabel>Параметры</guilabel>. </para>
    <figure>
      <title>Окно редактора параметра Product</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_4.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля параметра. В поле <guilabel>Имя параметра</guilabel> введите <userinput>Product</userinput>, в качестве <glossterm linkend="glossary_alias_id">алиаса</glossterm> параметра укажите <userinput>product</userinput>. Выберите тип параметра <userinput>Объект</userinput> из списка типов. Далее установите флажок  <guilabel>Связанная сущность?</guilabel> и <guilabel>Обязательный параметр?</guilabel>. В качестве сущности выберите <userinput>Product</userinput> из списка сущностей. В списке экранов выбора сущности найдите экран <userinput>shop$Product.browse</userinput>. Далее перейдите на вкладку <guilabel>Локализация</guilabel>.</para>
    <figure>
      <title>Вкладка локализации параметра</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_5.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В поле <guilabel>Строки локализации</guilabel> введите значение <userinput>ru=Товар</userinput> и нажмите на кнопку <guibutton>ОК.</guibutton></para>
    <para>Далее приступим к созданию полос отчета. Для создания новой полосы выделите корневую полосу отчета <guilabel>Root</guilabel> и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <figure>
      <title>Окно создания полос отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_6.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля источника данных значениями, приведенными на рисунке.</para>
    <figure>
      <title>Создание полосы Product</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_6.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <warning>
      <para>Обратите внимание, имя параметра для связанной сущности  должно совпадать с  <glossterm linkend="glossary_alias_id">алиасом</glossterm> входного параметра.</para>
    </warning>
    <para>После создания полос перейдите на вкладку <guilabel>Локализация</guilabel> редактора отчетов и введите в поле <guilabel>Строки локализации </guilabel>следующее:</para>
    <para><userinput>ru=Информация о товаре</userinput></para>
    <para>После этого нажмите на кнопку <guibutton>ОК</guibutton>. Новый отчет создан и сохранен в базе данных.</para>
    <para>Создадим кнопку в браузере сущности, по которой будет вызываться созданный отчет.</para>
    <para>Создавать кнопку нужно следующим образом:</para>
    <itemizedlist>
      <listitem>
        <para>Для печатной формы, вызываемой из экрана редактирования сущности, необходимо создать кнопку и задать ей <code>action</code> <code>EditorPrintFormAction</code>. В конструктор необходимо передать текущий <code>Editor</code>  и <code>message id</code> подписи кнопки.</para>
      </listitem>
      <listitem>
        <para>Для печатной формы, вызываемой из браузера сущности, необходимо создать кнопку и задать ей <code>action</code> <code>TablePrintFormAction</code>. В конструктор необходимо передать текущее окно,  таблицу, из которой будут выбираться сущности, и булевский параметр <code>multiObjects</code>, который определяет, является ли отчет печатной формой (<code>false</code>) или печатной формой списка (<code>true</code>). В первом случае берется один выбранный объект и передается в параметр типа <code>Объект</code>. Во втором случае берется <code>List</code> выбранных объектов и передается в параметр типа <code>Список объектов</code>.</para>
      </listitem>
    </itemizedlist>
    <para>В XML-дескрипторе браузера сущности <code>Product</code> определите кнопку следующим образом:</para>
    <programlisting>&lt;buttonsPanel&gt;
    &lt;!--others buttons--&gt;
    &lt;button id=&quot;print&quot;/&gt;
&lt;/buttonsPanel&gt;</programlisting>
    <para>В контроллере браузера сущности создайте <code>action</code> и установите его для определенной ранее кнопки.</para>
    <programlisting>TablePrintFormAction tablePrintFormAction = new TablePrintFormAction(this, productsTable, false);
print.setAction(tablePrintFormAction);</programlisting>
    <para>Пересоберите проект и зайдите на экран со списком сущностей.</para>
    <figure>
      <title>Выполнение отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_7.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Как видно из рисунка, на панели с кнопками появилась кнопка <guibutton>Отчет</guibutton>. Выделите интересующий товар и нажмите на кнопку <guibutton>Отчет</guibutton>. Далее можно посмотреть выгрузившийся отчет.</para>
    <figure>
      <title>Выгруженный отчет</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example3_8.png"/>
        </imageobject>
      </mediaobject>
    </figure>
  </section>
  <section id="report4_id">
    <title>Простой отчет с шаблоном *.xls в системе ТЕЗИС</title>
    <para>Данный отчет представляет собой информацию о  документах, находящихся на согласовании у пользователя, который задается параметром отчета.</para>
    <para>Начнем формирование отчета с создания шаблона. Для этого откройте <application>OpenOffice.org Calc</application>. Создайте в файле следующий шаблон отчета, представленный на рисунке.</para>
    <figure>
      <title>Создание шаблона отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_1.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Задайте именованные регионы согласно изображениям, представленным ниже.</para>
    <figure>
      <title>Именованный регион Header</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_2.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион User</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_3.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион Date</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_4.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион HeaderOfTable</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_5.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион Band</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_6.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион Band_2</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_7.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <figure>
      <title>Именованный регион Band_2_red</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_8.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Сохраните шаблон отчета, назвав его <filename>forEndorsement.xls</filename>.</para>
    <para>Далее зайдите в подсистему создания отчетов и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <para>В поле <guilabel>Имя</guilabel> введите имя отчета − <userinput>Отчет по согласуемым документам</userinput>, в качестве типа вывода отчета выберите значение <userinput>Простой отчет</userinput>. </para>
    <figure>
      <title>Окно создания отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_9.png" contentwidth="85%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Далее на панели <guilabel>Шаблоны</guilabel> нажмите на кнопку <guibutton>Создать</guibutton>. После этого откроется диалоговое окно, представленное на рисунке.</para>
    <figure>
      <title/>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_10.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>В качестве кода шаблона оставьте значение по умолчанию, в поле <guilabel>Тип вывода</guilabel> выберите значение <userinput>Xls</userinput>. Далее нажмите на кнопку <guibutton>Загрузить</guibutton> и в открывшемся окне укажите путь к созданному ранее шаблону <filename>forEndorsement.xls</filename>.</para>
    <para>Далее создадим входные параметры отчета. Очевидно, входным параметром будет являться пользователь, выбранный из списка пользователей. Для создания параметра нажмите на кнопку <guibutton>Создать</guibutton> на панели <guilabel>Параметры</guilabel>. </para>
    <figure>
      <title>Окно редактора параметра User</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_11.png" contentwidth="80%"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля параметра. В поле <guilabel>Имя параметра</guilabel> введите <userinput>Пользователь</userinput>, в качестве <glossterm linkend="glossary_alias_id">алиаса</glossterm> параметра укажите <userinput>user</userinput>. Выберите тип параметра <userinput>Объект</userinput> из списка типов. Далее установите флажок  <guilabel>Обязательный параметр?</guilabel>. В качестве сущности выберите <userinput>User</userinput> из списка сущностей. В списке экранов выбора сущности найдите экран <userinput>sec$User.browse</userinput>.</para>
    <para>Далее приступим к созданию полос отчета. Для создания новой полосы выделите корневую полосу отчета <guilabel>Root</guilabel> и нажмите на кнопку <guibutton>Создать</guibutton>.</para>
    <figure>
      <title>Создание полос отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example1_6.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Заполните поля источника данных значениями, приведенными на рисунке.</para>
    <figure>
      <title>Создание полосы User</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_12.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Текст запроса JPQL:</para>
    <programlisting>select u.name as user from sec$User u where u.id = ${user}</programlisting>
    <warning>
      <para>Обратите внимание, что <glossterm linkend="glossary_alias_id">алиас</glossterm> в запросе называется также, как в созданном шаблоне, а для фильтрации значений передается входной параметр отчета <code>${user}</code>.</para>
    </warning>
    <para>После создания полосы отчета <guilabel>User</guilabel> создайте  полосу отчета <guilabel>Date</guilabel>. </para>
    <figure>
      <title>Создание полосы Date</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_13.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Далее создайте полосу отчета <guilabel>Band</guilabel>, в которую будут выгружаться основные данные отчета.</para>
    <figure>
      <title>Создание полосы Band</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_14.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Текст запроса JPQL:</para>
    <programlisting>select wa.card.description as name, wa.dueDate as planDate from wf$Assignment wa 
where wa.user.id=${user} and wa.name = &apos;Endorsement&apos;
and wa.finished is null</programlisting>
    <para>Далее создадим полосу отчета <guilabel>Band_2</guilabel>, в которой будет проводиться подсчет общего количества документов, находящихся на согласовании у пользователя.</para>
    <figure>
      <title>Создание полосы Band_2</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_15.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Текст запроса JPQL:</para>
    <programlisting>select count(wa.id) as total from wf$Assignment wa where wa.user.id=${user} 
and wa.name = &apos;Endorsement&apos; and wa.finished is null</programlisting>
    <para>Далее создадим полосу отчета <guilabel>Band_2_red</guilabel>, в которой будет проводиться подсчет  количества документов, находящихся на согласовании у пользователя, срок которых истек.</para>
    <figure>
      <title>Создание полосы Band_2_red</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_16.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Текст запроса SQL:</para>
    <programlisting>select count(WA.ID) as overdue from WF_ASSIGNMENT WA left outer join SEC_USER SU 
on (WA.USER_ID=SU.ID) where SU.ID=${user} and WA.NAME= &apos;Endorsement&apos;
and WA.FINISHED is null and WA.DUE_DATE&lt;now()</programlisting>
    <para>После создания полос отчета создайте пустые полосы отчета и расположите их в порядке, определенном на рисунке. </para>
    <figure>
      <title>Полосы отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_17.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Полосы отчета пустые, так как в соответствующие им именованные регионы шаблона не требуется выводить данные из базы данных.</para>
    <para>После этого нажмите на кнопку <guibutton>ОК</guibutton>. Новый отчет создан и сохранен в базе данных.</para>
    <para>Запустим отчет на выполнение. Для этого вернитесь на вкладку <guilabel>Список отчетов</guilabel> (<guimenu>Отчеты</guimenu> −&gt; <guimenu>Отчеты</guimenu>). </para>
    <figure>
      <title>Выполнение отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_18.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выделите отчет <guilabel>Отчет по согласуемым документам</guilabel> в списке отчетов и нажмите на кнопку <guibutton>Выполнить</guibutton>. После этого откроется окно ввода параметров отчета. Данное окно представлено на рисунке.</para>
    <figure>
      <title>Окно ввода параметров отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_19.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выберите пользователя, у которого Вы хотели бы просмотреть документы, находящиеся на согласовании, с помощью кнопки <inlinemediaobject>
        <imageobject>
          <imagedata fileref="img/dots.png"/>
        </imageobject>
      </inlinemediaobject>. </para>
    <para>После этого нажмите на кнопку <guibutton>Печатать отчет</guibutton> в окне ввода параметров отчета.</para>
    <figure>
      <title>Печать отчета</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_20.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <para>Выгруженный отчет представлен на рисунке ниже.</para>
    <figure>
      <title>Выгруженный отчет</title>
      <mediaobject>
        <imageobject>
          <imagedata align="center" fileref="img/example4_21.png"/>
        </imageobject>
      </mediaobject>
    </figure>
  </section>
</chapter>
